PKG_CPPFLAGS = -I. -Iyajl -Ibson -Imongoc -include apple.h \
 -I/opt/csw/include \
 -DBSON_COMPILATION -DMONGOC_COMPILATION #-DBSON_DISABLE_CHECKS -DMONGOLITE_DEBUG

LIBYAJL = yajl/yajl_alloc.c yajl/yajl_buf.c yajl/yajl_encode.c yajl/yajl_gen.c \
          yajl/yajl_lex.c yajl/yajl_parser.c yajl/yajl_tree.c yajl/yajl_version.c \
          yajl/yajl.c

LIBBSON = bson/bcon.c bson/bson-atomic.c bson/bson-clock.c bson/bson-context.c \
          bson/bson-error.c bson/bson-iso8601.c bson/bson-iter.c bson/bson-json.c \
          bson/bson-keys.c bson/bson-md5.c bson/bson-memory.c bson/bson-oid.c \
          bson/bson-reader.c bson/bson-string.c bson/bson-timegm.c bson/bson-utf8.c \
          bson/bson-value.c bson/bson-version.c bson/bson-writer.c bson/bson.c

LIBMONGOC = mongoc/mongoc-array.c mongoc/mongoc-b64.c mongoc/mongoc-buffer.c \
            mongoc/mongoc-bulk-operation.c mongoc/mongoc-client-pool.c mongoc/mongoc-client.c \
            mongoc/mongoc-cluster.c mongoc/mongoc-collection.c mongoc/mongoc-counters.c \
            mongoc/mongoc-cursor-array.c mongoc/mongoc-cursor-cursorid.c \
            mongoc/mongoc-cursor-transform.c mongoc/mongoc-cursor.c mongoc/mongoc-database.c \
            mongoc/mongoc-gridfs-file-list.c mongoc/mongoc-gridfs-file-page.c \
            mongoc/mongoc-gridfs-file.c mongoc/mongoc-gridfs.c mongoc/mongoc-index.c \
            mongoc/mongoc-init.c mongoc/mongoc-list.c mongoc/mongoc-log.c \
            mongoc/mongoc-matcher-op.c mongoc/mongoc-matcher.c mongoc/mongoc-queue.c \
            mongoc/mongoc-rand.c mongoc/mongoc-read-prefs.c mongoc/mongoc-rpc.c \
            mongoc/mongoc-sasl.c mongoc/mongoc-scram.c mongoc/mongoc-socket.c mongoc/mongoc-ssl.c \
            mongoc/mongoc-stream-buffered.c mongoc/mongoc-stream-file.c \
            mongoc/mongoc-stream-gridfs.c mongoc/mongoc-stream-socket.c mongoc/mongoc-stream-tls.c \
            mongoc/mongoc-stream.c mongoc/mongoc-uri.c mongoc/mongoc-util.c \
            mongoc/mongoc-write-command.c mongoc/mongoc-write-concern.c

#LIBMONGOC = $(wildcard mongoc/*.c)
#LIBBSON = $(wildcard bson/*.c)
#LIBYAJL = $(wildcard yajl/*.c)

PKG_LIBS = -L. -lmongoc -lbson -lssl -lyajl -lcrypto -lsasl2

$(SHLIB): all

all: libyajl.a libbson.a libmongoc.a

clean:
	rm -f *.o mongoc/*.o bson/*.o yajl/*.o
	rm -f *.a

libyajl.a: $(LIBYAJL:.c=.o)
	$(AR) rcs libyajl.a yajl/*.o

libbson.a: $(LIBBSON:.c=.o)
	$(AR) rcs libbson.a bson/*.o

libmongoc.a: $(LIBMONGOC:.c=.o)
	$(AR) rcs libmongoc.a mongoc/*.o
